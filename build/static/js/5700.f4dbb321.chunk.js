"use strict";(self.webpackChunkmantis_material_react=self.webpackChunkmantis_material_react||[]).push([[5700],{55700:function(e,i,t){t.r(i);var s=t(1413),r=t(29439),n=t(47313),l=t(19860),d=t(56104),a=t(42832),o=t(61113),c=t(69099),u=t(9019),x=t(15103),m=t(24631),Z=t(83882),h=t(15480),p=t(19536),j=t(89688),b=t(97133),g=t(16366),f=t(35604),v=t(71325),P=t(85554),k=t(51305),S=t(58115),F=t(88298),T=t(2244),q=t(56462),w=t(41366),E=t(21933),_=t(58467),C=t(46417);i.default=function(){var e=(0,P.I0)(),i=(0,l.Z)(),t=(0,_.s0)(),y=(0,n.useState)([]),I=(0,r.Z)(y,2),A=I[0],z=I[1],R=(0,n.useState)([]),V=(0,r.Z)(R,2),J=V[0],W=V[1],B=(0,P.v9)((function(e){return e.checkpoint.disctricts})),L=B.listStatus,M=B.districtsTab,O=(0,P.v9)((function(e){return e.checkpoint.create})).createStatus;(0,n.useEffect)((function(){z([]),W([]),L!=F.J_.succeed&&e((0,k.J)()),e((0,S.U8)())}),[]);var H=function(e){return E.Rx().test({name:"coordinate",message:(0,C.jsx)(v.Z,{id:"".concat(e,"-invalid")}),test:function(i){return!!i&&(("latitude"!==e||!(i<-90||i>90))&&("longitude"!==e||!(i<-180||i>180)))}})},D=E.Ry({name:E.Z_().required((0,C.jsx)(v.Z,{id:"checkpoint-name-required"})).matches(/^[a-zA-Z0-9\s]*[a-zA-Z][a-zA-Z0-9\s]*$/,(0,C.jsx)(v.Z,{id:"checkpoint-name-characters"})),district:E.Ry().required((0,C.jsx)(v.Z,{id:"district-required"})),latitude:H("latitude").required((0,C.jsx)(v.Z,{id:"latitude-required"})),longitude:H("longitude").required((0,C.jsx)(v.Z,{id:"longitude-required"})),responsable:E.Z_().when("userTab",{is:function(e){return e&&e.length>0&&e.some((function(e){return!0===e.isR}))},then:E.Z_().required((0,C.jsx)(v.Z,{id:"responsable-required"}))})}),K=(0,f.TA)({initialValues:{name:"",district:null,latitude:"",longitude:"",responsable:"",animalTabs:[],userTab:[]},onSubmit:function(i){if(0!==A.length)if(A.length<2)K.setErrors({submit:(0,C.jsx)(v.Z,{id:"agents-tab-min-required"})});else if(0!==J.length)if(A.some((function(e){return e.username===i.responsable})))if(J.every((function(e){return parseFloat(e.max_animal)>0}))){var t=A.map(w.sH),s=J.map(w.qf);e((0,S.KC)({animals:s,libelle:i.name,latitude:i.latitude,longitude:i.longitude,users:t,id_district:K.values.district?K.values.district.pk:null}))}else K.setErrors({submit:(0,C.jsx)(v.Z,{id:"animals-limit"})});else K.setErrors({responsable:(0,C.jsx)(v.Z,{id:"responsable-not-found"})});else K.setErrors({submit:(0,C.jsx)(v.Z,{id:"animals-tab-required"})});else K.setErrors({submit:(0,C.jsx)(v.Z,{id:"agents-tab-required"})})},validationSchema:D});if((0,n.useEffect)((function(){K.setErrors({submit:void 0})}),[A,J]),O==F.J_.loading||L==F.J_.loading)return(0,C.jsx)(T.Z,{title:(0,C.jsx)(v.Z,{id:"loading"})});L!=F.J_.error&&0!=M.length||(T.Z,v.Z);var N=K.handleSubmit,U=K.getFieldProps,$=K.setStatus,G=K.setSubmitting,Q=K.errors,X=K.touched,Y=K.setErrors,ee=K.resetForm;return(0,C.jsxs)(j.Z,{content:!1,sx:{overflow:"visible"},children:[(0,C.jsx)(d.Z,{sx:{position:"sticky",top:"60px",bgcolor:i.palette.background.default,zIndex:1,borderBottom:"1px solid ".concat(i.palette.divider)},children:(0,C.jsxs)(a.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{width:1},children:[(0,C.jsx)(o.Z,{variant:"h5",sx:{m:0,pl:1.5},children:(0,C.jsx)(v.Z,{id:"new-checkpoint"})}),(0,C.jsxs)(a.Z,{direction:"row",spacing:1,sx:{px:1.5,py:.75},children:[(0,C.jsx)(c.Z,{color:"error",size:"small",onClick:function(){K.resetForm(),z([]),W([]),t("/apps/checkpoints/list/")},children:(0,C.jsx)(v.Z,{id:"cancel"})}),(0,C.jsx)(c.Z,{variant:"contained",size:"small",onClick:K.handleSubmit,children:(0,C.jsx)(v.Z,{id:"submit"})})]})]})}),(0,C.jsx)(f.Hy,{value:K,children:(0,C.jsxs)(f.l0,{autoComplete:"off",noValidate:!0,onSubmit:N,children:[(0,C.jsx)(o.Z,{variant:"h5",component:"div",sx:{p:3},children:(0,C.jsx)(v.Z,{id:"general-info"})}),(0,C.jsxs)(u.ZP,{container:!0,spacing:3,sx:{p:5},children:[(0,C.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,C.jsxs)(u.ZP,{container:!0,spacing:3,children:[(0,C.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,C.jsxs)(a.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,C.jsx)(u.ZP,{item:!0,xs:5,children:(0,C.jsx)(x.Z,{htmlFor:"name",children:(0,C.jsx)(v.Z,{id:"name"})})}),(0,C.jsx)(u.ZP,{item:!0,xs:15,children:(0,C.jsx)(m.Z,(0,s.Z)((0,s.Z)({fullWidth:!0,id:"name",placeholder:"Enter Checkpoint Name"},U("name")),{},{error:Boolean(X.name&&Q.name),helperText:X.name&&Q.name}))})]})}),(0,C.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,C.jsxs)(a.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,C.jsx)(u.ZP,{item:!0,xs:4,children:(0,C.jsx)(x.Z,{htmlFor:"district",children:(0,C.jsx)(v.Z,{id:"district"})})}),(0,C.jsxs)(u.ZP,{item:!0,xs:12,children:[(0,C.jsx)(Z.Z,{id:"district",value:K.values.district,onChange:function(e,i){K.setFieldValue("district",i)},getOptionLabel:function(e){return e.name},options:M,isOptionEqualToValue:function(e,i){return e.pk===i.pk},renderInput:function(e){return(0,C.jsx)(m.Z,(0,s.Z)((0,s.Z)({},e),{},{placeholder:"Select District",sx:{"& .MuiAutocomplete-input.Mui-disabled":{WebkitTextFillColor:i.palette.text.primary}}}))}}),K.touched.district&&K.errors.district&&(0,C.jsx)(h.Z,{error:!0,id:"helper-text-district",children:K.errors.district})]})]})})]})}),(0,C.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,C.jsxs)(u.ZP,{container:!0,spacing:3,children:[(0,C.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,C.jsxs)(a.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,C.jsx)(u.ZP,{item:!0,xs:5,children:(0,C.jsx)(x.Z,{htmlFor:"latitude",children:(0,C.jsx)(v.Z,{id:"latitude"})})}),(0,C.jsx)(u.ZP,{item:!0,xs:15,children:(0,C.jsx)(m.Z,(0,s.Z)((0,s.Z)({fullWidth:!0,id:"latitude",type:"number",placeholder:"Enter Latitude"},U("latitude")),{},{error:Boolean(X.latitude&&Q.latitude),helperText:X.latitude&&Q.latitude}))})]})}),(0,C.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,C.jsxs)(a.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,C.jsx)(u.ZP,{item:!0,xs:5,children:(0,C.jsx)(x.Z,{htmlFor:"longitude",children:(0,C.jsx)(v.Z,{id:"longitute"})})}),(0,C.jsx)(u.ZP,{item:!0,xs:15,children:(0,C.jsx)(m.Z,(0,s.Z)((0,s.Z)({fullWidth:!0,id:"longitude",type:"number",placeholder:"Enter Longitude"},U("longitude")),{},{error:Boolean(X.longitude&&Q.longitude),helperText:X.longitude&&Q.longitude}))})]})})]})})]}),(0,C.jsx)(p.Z,{}),(0,C.jsx)(o.Z,{variant:"h5",component:"div",sx:{p:3},children:(0,C.jsx)(v.Z,{id:"configuration"})}),(0,C.jsxs)(u.ZP,{container:!0,spacing:3,sx:{p:5},children:[Q.submit&&(0,C.jsx)(u.ZP,{item:!0,xs:12,children:(0,C.jsx)(h.Z,{error:!0,children:Q.submit})}),A.length>0&&(0,C.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,C.jsxs)(a.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,C.jsx)(u.ZP,{item:!0,xs:4,children:(0,C.jsx)(x.Z,{htmlFor:"responsable",children:(0,C.jsx)(v.Z,{id:"responsable"})})}),(0,C.jsxs)(u.ZP,{item:!0,xs:12,children:[(0,C.jsx)(Z.Z,{id:"responsable",value:K.values.responsable,onChange:function(e,i){K.setFieldValue("responsable",i);var t=A.map((function(e){return(0,s.Z)((0,s.Z)({},e),{},{isR:e.username===i})}));z(t)},options:A.map((function(e){return e.username})),getOptionLabel:function(e){return e},renderInput:function(e){return(0,C.jsx)(m.Z,(0,s.Z)((0,s.Z)({},e),{},{placeholder:"Select Responsable",sx:{"& .MuiAutocomplete-input.Mui-disabled":{WebkitTextFillColor:i.palette.text.primary}}}))}}),K.touched.responsable&&K.errors.responsable&&(0,C.jsx)(h.Z,{error:!0,id:"helper-text-responsable",children:K.errors.responsable})]})]})}),(0,C.jsx)(u.ZP,{item:!0,xs:12,md:12,children:(0,C.jsxs)(u.ZP,{container:!0,spacing:3,children:[(0,C.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,C.jsx)(b.Z,{selectedTab:A,setSelectedTab:z})}),(0,C.jsx)(u.ZP,{item:!0,xs:12,md:6,children:(0,C.jsx)(g.Z,{selectedTab:J,setSelectedTab:W,setFormikAnimalTabs:K.setFieldValue,formik:K})})]})})]}),(0,C.jsx)(q.Z,{resetForm:ee,setErrors:Y,setStatus:$,setSubmitting:G})]})})]})}}}]);